<!DOCTYPE html>
<html lang="en">

<head>
    {% load staticfiles %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>{% block title %}{% endblock %}</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon.png' %}">
    <!-- Bootstrap Core CSS -->
    <link href="{% static 'css/lib/bootstrap/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Custom CSS -->
        {% block lib %}{% endblock %}
    <link href="{% static 'css/helper.css' %}" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">

    {% block css %}
    {% endblock %}
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:** -->
    <!--[if lt IE 9]>
    <script src="https:**oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https:**oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

<![endif]-->

</head>

<body class="mini-sidebar fix-header fix-sidebar">
    <!-- Preloader - style you can find in spinners.css -->
    <div class="preloader">
        <svg class="circular" viewBox="25 25 50 50">
			<circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" /> </svg>
    </div>
    <!-- Main wrapper  -->
    <div id="main-wrapper">
        <!-- header header  -->
        <div class="header">
            <nav class="navbar top-navbar navbar-expand-md navbar-light">
                <!-- Logo -->
                <div class="navbar-header" >
                    <a class="navbar-brand" href="{% url 'leader:home_leader' %}">
                        <span><img src="{% static 'images/meditech.png' %}" alt="homepage" style="width:260px;height:40px;"></span>
                    </a>
                </div>
                <!-- End Logo -->
                <div class="navbar-collapse">
                    <!-- toggle and nav items -->
                    <ul class="navbar-nav mr-auto mt-md-0">
                        <!-- This is  -->
                        <li class="nav-item"> <a class="nav-link nav-toggler hidden-md-up text-muted  " href="javascript:void(0)"><i class="mdi mdi-menu"></i></a> </li>
                        <li class="nav-item m-l-10"> <a class="nav-link sidebartoggler hidden-sm-down text-muted  " href="javascript:void(0)"><i class="ti-menu"></i></a> </li>
                        <!-- Messages -->
                        <!-- End Messages -->
                    </ul>
                    <!-- User profile and search -->
                    <ul class="navbar-nav my-lg-0">
                        <!-- End Comment -->
                        <!-- Messages -->
                        <li class="nav-item dropdown chat_">
                            <a class="nav-link dropdown-toggle text-muted" onclick="chatFunction()"  id="2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fa fa-envelope"></i>
								<div class="notify chat_noti"> </div>
							</a>
                            <div class="dropdown-menu dropdown-menu-right mailbox animated zoomIn" aria-labelledby="2">
                                <ul>
                                    <li>
                                        <div class="drop-title chat_msg"></div>
                                    </li>
                                    <li>
                                        <div class="message-center notification_chat">
                                            <!-- Message -->

                                        </div>
                                    </li>
                                    <li>
                                        <a class="nav-link text-center" href="javascript:void(0);"> <strong>Xem tất cả</strong> <i class="fa fa-angle-right"></i> </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <!-- End Messages -->
                        <!-- Profile -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-muted"   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="{% static 'images/avatar.png' %}" alt="user" class="profile-pic" /></a>
                            <div class="dropdown-menu dropdown-menu-right animated zoomIn">
                                <ul class="dropdown-user">
                                    <li><a href="{% url 'leader:leader_profile' %}"><i class="ti-user"></i> Thông tin</a></li>
                                    <li><a href="{% url 'leader:logout_leader' %}"><i class="fa fa-power-off"></i> Đăng xuất</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <!-- End header header -->
        <!-- Left Sidebar  -->
        <div class="left-sidebar">
            <!-- Sidebar scroll-->
            <div class="scroll-sidebar">
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav">
                    <ul id="sidebarnav">
                    	<li class="nav-label">Quản trị viên</li>
                        <li><a href="{% url 'leader:home_chart' %}"><i class="fa fa-bar-chart"></i> Biểu đồ </a></li>
                        <li><a href="{% url 'leader:home_leader' %}"><i class="fa fa-ticket"></i> Quản lý yêu cầu </a></li>
                        <li><a href="{% url 'leader:leader_manage_agent' %}"><i class="fa fa fa-user-secret"></i> Quản lý nhân viên </a></li>
                        {% if leader.position == 4 %}
                            <li><a href="{% url 'leader:leader_to_agent' %}"><i class="fa fa-exchange"></i> Chế độ nhân viên xử lý </a></li>
                        {% endif%}
                    </ul>
                    </ul>
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </div>
        <!-- End Left Sidebar  -->
        <!-- Page wrapper  -->
        {% block content %}{% endblock %}
        
    </div>
    <!-- End Wrapper -->
    <!-- All Jquery -->
    <script src="{% static 'js/lib/jquery/jquery.min.js' %}"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="{% static 'js/lib/bootstrap/js/popper.min.js' %}"></script>
    <script src="{% static 'js/lib/bootstrap/js/bootstrap.min.js' %}"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <script src="{% static 'js/jquery.slimscroll.js' %}"></script>
    <!--Menu sidebar -->
    <script src="{% static 'js/sidebarmenu.js' %}"></script>
    <!--stickey kit -->
    <script src="{% static 'js/lib/sticky-kit-master/dist/sticky-kit.min.js' %}"></script>
    <!--Custom JavaScript -->
    <script src="{% static 'js/scripts.js' %}"></script>
    <script src="{% static 'js/lib/datatables/datatables.min.js' %}"></script>
    <script src="{% static 'js/ColReorderWithResize.js' %}"></script>
    
    <script src="{% static 'js/jquery.easy-autocomplete.js' %}"></script>
    <script src="{% static 'js/jquery.easy-autocomplete.min.js' %}"></script>
    <!-- CSS file -->
    <link href="{% static 'css/easy-autocomplete.css' %}" rel="stylesheet">
    <link href="{% static 'css/easy-autocomplete.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/easy-autocomplete.themes.css' %}" rel="stylesheet">
    <link href="{% static 'css/easy-autocomplete.themes.min.css' %}" rel="stylesheet">

    <audio id="myAudio">
        <source src="{% static 'ping.mp3' %}" type="audio/mpeg">
    </audio>
<script>
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
        $(".sidebar-nav").hover(function(){
            $(".left-sidebar").css("width", "260px");
        }, function(){
            $(".left-sidebar").css("width", "auto");
        });
    var agentName = {{ agent_name }};
    var group_agent_Socket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/agent/'+agentName+'+group_agent_Socket/');

    var options = {
        url: "data",

        getValue: "fullname",
        template: {
            type: "description",
            fields: {
                description: "username"
            }
        },

        list: {
            match: {
                enabled: true
            },
            onChooseEvent: function() {
                var fullname = $("#search").getSelectedItemData().fullname;
                var username = $("#search").getSelectedItemData().username;
                var element = '<li><input style="transform: scale(1.3)" type="checkbox" class="check_agent" name="'+username+'" value="'+username+'" checked >'+fullname+'</li>';
                var list_old = $("#list_agent").text();
                if (list_old.includes(fullname) == false){
                    $('#list_agent').append(element);
                }
                $("#search").val("");
            }
        },
        theme: "square"
    };
    $("#search").easyAutocomplete(options);

    function formatAMPM(date) {
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        minutes = minutes < 10 ? '0'+minutes : minutes;
        var strTime = hours + ':' + minutes + ' ' + ampm + ' ' +date.getDate()+'/'+(date.getMonth()+1)+'/'+date.getFullYear();
        return strTime;
    }

    function countdowntime(id){
        $('#'+id+' .downtime').each(function(){
            var tkid = $(this).attr('id').split('-')[1];
            var dateend = $('body #dateend'+tkid).text();
            var countDownDate = new Date(dateend).getTime();
            var expried = $('#leader'+tkid).next().next().text();
            var x = setInterval(function() {
                clearInterval(sessionStorage.getItem(tkid));
                if (expried){
                    $('#leader'+tkid).next().next().hide();
                    document.getElementById("downtime-"+tkid).innerHTML = expried;
                    if (expried == 'Đúng hạn'){
                        document.getElementById("downtime-"+tkid).classList.remove("label-warning");
                        document.getElementById("downtime-"+tkid).classList.add("label-success");
                    }else{
                        document.getElementById("downtime-"+tkid).classList.remove("label-warning");
                        document.getElementById("downtime-"+tkid).classList.add("label-danger");
                    }
                    
                }else{
                    // Get todays date and time
                    var now = new Date().getTime();
                    
                    // Find the distance between now an the count down date
                    var distance = countDownDate - now;
                    
                    // Time calculations for days, hours, minutes and seconds
                    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    
                    // Output the result in an element with id="demo"
                    
                    
                    // If the count down is over, write some text 
                    if (distance < 0) {
                        clearInterval(x);
                        document.getElementById("downtime-"+tkid).innerHTML = "Hết thời gian";
                    }else{
                        document.getElementById("downtime-"+tkid).innerHTML = days + "ngày " + hours + "giờ "
        + minutes + "phút " + seconds + "giây ";
                        if (distance < 0) {
                            clearInterval(x);
                            document.getElementById("downtime-"+tkid).innerHTML = "Hết thời gian";
                        }
                    }

                    if (typeof(Storage) !== "undefined") {
                        sessionStorage.setItem(tkid, x);
                    } else {
                        document.write('Trình duyệt của bạn không hỗ trợ local storage');
                    }
                }
            }, 1000);
        });
    }

    group_agent_Socket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];

        // Thong bao va load lai table home_agent khi co new ticket hoac co 1 agent nhan xu ly ticket
        if (message[0] != '<'){
            setTimeout(function(){
                $('.tk_table').DataTable().ajax.reload(null,false);
            }, 2000);
        }
    };
</script>
{% block js %}
    {% endblock %}
</body>
</html>